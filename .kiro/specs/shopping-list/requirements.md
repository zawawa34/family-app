# Requirements Document

## はじめに

買い物リスト機能は、家族で共有できる買い物リスト管理システムです。スマートフォンでの利用を前提とし、自宅や外出先での商品追加から店舗での商品確認・チェック、購入後の削除まで、一連の買い物フローをシームレスにサポートします。

この機能により、家族メンバーは誰がどこで何を買うべきかを明確に把握でき、買い忘れや重複購入を防ぎ、効率的な買い物体験を実現します。

## Requirements

### Requirement 1: 買い物リストの基本管理
**Objective:** 家族メンバーとして、家族全員で共有できる買い物リストを利用したい。これにより、誰もが最新の買い物情報にアクセスでき、効率的に買い物を進められる。

#### Acceptance Criteria

1. WHEN 認証済みユーザーがアプリケーションにログインする THEN 買い物リストシステムは 家族共有の買い物リストへのアクセスを提供すること
2. WHEN 家族メンバーがリストにアクセスする THEN 買い物リストシステムは 最新の商品情報を表示すること
3. WHEN ユーザーが画面を手動でリフレッシュする THEN 買い物リストシステムは サーバーから最新のデータを取得し表示を更新すること
4. WHERE スマートフォンブラウザからアクセスする場合 THE 買い物リストシステムは モバイル最適化されたUIを表示すること

### Requirement 2: 商品の追加
**Objective:** 家族メンバーとして、必要な商品を買い物リストに簡単に追加したい。これにより、買い忘れを防ぎ、必要な情報を記録できる。

#### Acceptance Criteria

1. WHEN 買い物リストページを表示する THEN 買い物リストシステムは 商品名入力フォームを常に画面上部に表示すること
2. WHEN ユーザーが商品名を入力しEnterキーまたは追加ボタンを押す THEN 買い物リストシステムは 画面遷移せずに新しい商品をリストに追加すること
3. IF 商品名が空のまま追加しようとする THEN 買い物リストシステムは バリデーションエラーを表示し追加を拒否すること
4. WHEN 商品が正常に追加される THEN 買い物リストシステムは 入力フォームをクリアし次の商品入力に備えること
5. WHEN 新しい商品が追加される THEN 買い物リストシステムは その商品をリストの末尾に配置すること
6. WHEN 商品が追加される THEN 買い物リストシステムは 商品を未チェック状態で登録すること
7. WHEN 商品が追加される AND 数量・メモ・購入店舗が入力されていない THEN 買い物リストシステムは これらの項目を空（null）として登録すること

### Requirement 3: 商品情報の編集
**Objective:** 家族メンバーとして、登録済みの商品情報を修正したい。これにより、情報の誤りを訂正したり、数量・メモ・購入店舗などの詳細を追加したりできる。

#### Acceptance Criteria

1. WHEN ユーザーが商品をタップする THEN 買い物リストシステムは 商品の編集フォームを表示すること
2. WHEN 商品の編集フォームを表示する THEN 買い物リストシステムは 商品名、数量、メモ、購入店舗の入力フィールドを表示すること
3. WHEN ユーザーが購入店舗フィールドに入力を開始する THEN 買い物リストシステムは 過去に入力された店舗名の候補を表示すること
4. WHEN ユーザーが商品情報を変更し保存ボタンを押す THEN 買い物リストシステムは 変更内容を保存しリスト表示を更新すること
5. IF 商品名を空にして保存しようとする THEN 買い物リストシステムは バリデーションエラーを表示し保存を拒否すること
6. WHEN ユーザーが編集をキャンセルする THEN 買い物リストシステムは 変更を破棄し元の内容を保持すること

### Requirement 4: 商品の並び替え
**Objective:** 家族メンバーとして、商品の順序を自由に変更したい。これにより、買い物ルートや優先度に応じた順序でリストを整理できる。

#### Acceptance Criteria

1. WHEN ユーザーが商品を長押しする THEN 買い物リストシステムは その商品をドラッグ可能な状態にすること
2. WHILE ユーザーが商品をドラッグしている THE 買い物リストシステムは リアルタイムで商品の位置をプレビュー表示すること
3. WHEN ユーザーが商品を新しい位置でドロップする THEN 買い物リストシステムは 商品の並び順を更新し保存すること
4. WHEN 商品の並び順が更新される THEN 買い物リストシステムは 他の商品の位置を自動的に再計算すること

### Requirement 5: 商品の削除
**Objective:** 家族メンバーとして、不要になった商品をリストから削除したい。これにより、リストを整理し最新の状態に保てる。

#### Acceptance Criteria

1. WHEN ユーザーが個別商品の削除ボタンを押す THEN 買い物リストシステムは 確認ダイアログを表示すること
2. WHEN ユーザーが削除を確認する THEN 買い物リストシステムは その商品をリストから削除すること
3. WHEN ユーザーが削除をキャンセルする THEN 買い物リストシステムは 商品を削除せず維持すること

### Requirement 6: 商品をカートに入れる機能
**Objective:** 店舗で買い物をする家族メンバーとして、買い物カゴに入れた商品をアプリ上で記録したい。これにより、買い忘れを防ぎ、まだカートに入れていない商品を明確に把握できる。

#### Acceptance Criteria

1. WHEN ユーザーが商品をタップする THEN 買い物リストシステムは その商品のカート追加状態を切り替えること
2. WHEN 商品がカートに入れられる THEN 買い物リストシステムは その商品を視覚的に区別して表示すること（グレーアウトや取り消し線など）
3. WHEN 商品のカート追加状態が変更される THEN 買い物リストシステムは 変更を即座にサーバーに保存すること
4. WHEN リストを表示する THEN 買い物リストシステムは カート内の商品とリスト内の商品を区別して表示すること

### Requirement 7: カート内商品の一括削除
**Objective:** 店舗での買い物を終えた家族メンバーとして、カートに入れた（購入済み）商品をまとめて削除したい。これにより、購入後のリスト整理を効率的に行える。

#### Acceptance Criteria

1. IF リストに1つ以上のカート内商品が存在する THEN 買い物リストシステムは 「カート内商品を削除」ボタンを表示すること
2. WHEN ユーザーが「カート内商品を削除」ボタンを押す THEN 買い物リストシステムは 削除確認ダイアログを表示すること
3. WHEN ユーザーが一括削除を確認する THEN 買い物リストシステムは すべてのカート内商品をリストから削除すること
4. IF リストにカート内商品が存在しない THEN 買い物リストシステムは 「カート内商品を削除」ボタンを非表示または無効化すること
5. WHEN カート内商品が一括削除される THEN 買い物リストシステムは 削除件数を通知メッセージで表示すること

### Requirement 8: 購入店舗によるフィルタリング
**Objective:** 特定の店舗で買い物をする家族メンバーとして、その店舗で購入予定の商品を確認したい。購入店舗未設定の商品も含めて表示することで、購入漏れを防ぐ。

#### Acceptance Criteria

1. WHEN ユーザーがフィルタボタンをタップする THEN 買い物リストシステムは 店舗選択メニューを表示すること
2. WHEN 店舗選択メニューを表示する THEN 買い物リストシステムは 「すべて」オプションと登録済みの店舗名リストを表示すること
3. WHEN ユーザーが特定の店舗を選択する THEN 買い物リストシステムは その店舗が設定されている商品と購入店舗が未設定の商品を表示すること
4. WHEN ユーザーが「すべて」を選択する THEN 買い物リストシステムは すべての商品を表示すること
5. WHEN 特定店舗でフィルタしている AND 購入店舗が未設定の商品が表示される THEN 買い物リストシステムは 未設定であることを視覚的に区別して表示すること（例：「店舗未設定」ラベルやアイコン）
6. WHEN フィルタが適用されている THEN 買い物リストシステムは 現在のフィルタ条件を画面上に明示すること

### Requirement 9: 購入店舗の入力補完
**Objective:** 家族メンバーとして、商品編集時に購入店舗を素早く入力したい。これにより、過去に使った店舗名を再入力する手間を省ける。

#### Acceptance Criteria

1. WHERE 商品編集フォームの購入店舗フィールドにおいて WHEN ユーザーが1文字以上入力する THEN 買い物リストシステムは 入力内容に部分一致する過去の店舗名を候補として表示すること
2. WHEN 候補リストを表示する THEN 買い物リストシステムは 最大10件の候補を使用頻度の高い順に表示すること
3. WHEN ユーザーが候補をタップする THEN 買い物リストシステムは その店舗名を入力フィールドに自動入力すること
4. IF 入力内容に一致する候補が存在しない THEN 買い物リストシステムは 候補リストを表示しないこと
5. WHEN ユーザーが候補以外の新しい店舗名を入力し保存する THEN 買い物リストシステムは その店舗名を履歴に追加すること

### Requirement 10: リスト表示の基本情報
**Objective:** 家族メンバーとして、買い物リストの状況を一目で把握したい。これにより、全体の進捗や残タスクを素早く確認できる。

#### Acceptance Criteria

1. WHEN 買い物リストを表示する THEN 買い物リストシステムは 各商品の商品名、数量、購入店舗、カート追加状態を表示すること
2. IF 商品の購入店舗が未設定である THEN 買い物リストシステムは 「店舗未設定」などの視覚的な表示をすること
3. IF 商品にメモが設定されている THEN 買い物リストシステムは メモ内容を表示すること
4. WHEN 買い物リストを表示する THEN 買い物リストシステムは 商品を設定された並び順（position）に従って表示すること
5. IF リストに商品が存在しない THEN 買い物リストシステムは 「商品を追加してください」といった空状態のメッセージを表示すること

### Requirement 11: レスポンシブ対応とタッチ操作
**Objective:** スマートフォンを使う家族メンバーとして、快適にアプリを操作したい。これにより、外出先や店舗でストレスなく利用できる。

#### Acceptance Criteria

1. WHERE スマートフォン画面サイズでアクセスする場合 THE 買い物リストシステムは 画面幅に応じたレイアウトで表示すること
2. WHEN ユーザーがタッチ操作を行う THEN 買い物リストシステムは 最小44x44pxのタップターゲットサイズを提供すること
3. WHEN ユーザーがボタンやリンクをタップする THEN 買い物リストシステムは 視覚的なフィードバック（ハイライトやアニメーション）を提供すること
4. WHEN ページがロード中の状態にある THEN 買い物リストシステムは ローディングインジケーターを表示すること
5. WHERE デザインシステムに基づく場合 THE 買い物リストシステムは Tailwind CSSの標準クラスのみを使用し、8ptグリッドシステムに準拠すること

### Requirement 12: データの永続化とエラーハンドリング
**Objective:** 家族メンバーとして、入力した情報が確実に保存されることを期待する。また、エラーが発生した際には適切に通知されたい。

#### Acceptance Criteria

1. WHEN ユーザーが商品を追加・編集・削除する THEN 買い物リストシステムは 変更をデータベースに永続化すること
2. IF サーバーとの通信エラーが発生する THEN 買い物リストシステムは ユーザーにエラーメッセージを表示すること
3. WHEN データベース操作が失敗する THEN 買い物リストシステムは ユーザーに再試行を促すメッセージを表示すること
4. WHEN 通信エラー後に接続が復旧する THEN 買い物リストシステムは ユーザーの手動リフレッシュにより最新データを取得すること

### Requirement 13: セキュリティとアクセス制御
**Objective:** 家族メンバーとして、自分の家族の買い物リストが他の家族からアクセスされないことを期待する。

#### Acceptance Criteria

1. WHEN ユーザーが買い物リストにアクセスする THEN 買い物リストシステムは ログイン済みであることを確認すること
2. IF ユーザーが未認証状態でアクセスしようとする THEN 買い物リストシステムは ログイン画面にリダイレクトすること
3. WHEN 認証済みユーザーがリストにアクセスする THEN 買い物リストシステムは そのユーザーの家族に紐づくリストのみを表示すること
4. WHEN ユーザーが商品を操作する THEN 買い物リストシステムは そのユーザーが家族メンバーであることを確認すること

### Requirement 14: 将来の拡張性
**Objective:** システム管理者として、将来的に個人リストやその他の機能を追加できる設計にしたい。

#### Acceptance Criteria

1. WHERE データモデル設計において THE 買い物リストシステムは 所有者情報（owner_id）を保持する構造を持つこと
2. WHERE データモデル設計において THE 買い物リストシステムは リストの共有設定を拡張可能な形で管理すること
3. WHEN 将来的にカテゴリ機能を追加する際 THEN 買い物リストシステムは 既存データに影響を与えずにカテゴリ情報を追加できること
