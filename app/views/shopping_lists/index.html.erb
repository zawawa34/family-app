<div class="min-h-screen bg-stone-50">
  <!-- ヘッダー -->
  <div class="bg-white border-b border-stone-200">
    <div class="max-w-7xl mx-auto px-4 py-6 md:px-6 lg:px-8">
      <div class="flex flex-col gap-2">
        <h1 class="text-3xl font-bold text-stone-900 leading-tight">買い物リスト</h1>
        <p class="text-base text-stone-600">
          <%= @shopping_list.unpicked_items_count %>件の商品 / <%= @shopping_list.picked_items_count %>件をカートに追加済み
        </p>
      </div>
    </div>
  </div>

  <!-- メインコンテンツ -->
  <div class="max-w-7xl mx-auto px-4 py-6 md:px-6 lg:px-8">
    <!-- フラッシュメッセージ -->
    <div id="flash_messages"></div>

    <!-- 商品追加フォーム -->
    <div class="bg-white rounded-xl shadow-sm border border-stone-100 overflow-hidden mb-6">
      <%= render partial: "shopping_items/form", locals: { shopping_list: @shopping_list, item: @shopping_list.items.build } %>
    </div>

    <!-- 店舗フィルタ -->
    <% if @available_stores.any? %>
      <div class="mb-6">
        <div class="bg-white rounded-xl shadow-sm border border-stone-100 p-4">
          <div class="flex items-center gap-3 flex-wrap">
            <span class="text-sm font-semibold text-stone-700">店舗:</span>

            <%= link_to shopping_lists_path,
                class: "inline-flex items-center px-4 py-2 rounded-lg text-sm font-medium transition-colors duration-150 min-h-[44px] #{@current_store.nil? ? 'bg-orange-600 text-white' : 'bg-stone-100 text-stone-700 hover:bg-stone-200 active:bg-stone-300'}" do %>
              すべて
            <% end %>

            <% @available_stores.each do |store| %>
              <%= link_to shopping_lists_path(store: store),
                  class: "inline-flex items-center px-4 py-2 rounded-lg text-sm font-medium transition-colors duration-150 min-h-[44px] #{@current_store == store ? 'bg-orange-600 text-white' : 'bg-stone-100 text-stone-700 hover:bg-stone-200 active:bg-stone-300'}" do %>
                <%= store %>
              <% end %>
            <% end %>
          </div>

          <% if @current_store.present? %>
            <div class="mt-3 text-sm text-stone-600">
              <span class="inline-flex items-center gap-1">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
                </svg>
                「<%= @current_store %>」でフィルタ中（店舗未設定商品も含む）
              </span>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>

    <!-- カート内商品の一括削除ボタン -->
    <% if @shopping_list.picked_items_count > 0 %>
      <div class="mb-6">
        <%= button_to shopping_list_picked_items_path(@shopping_list),
            method: :delete,
            form: { data: { turbo_stream: true, turbo_confirm: "カート内の#{@shopping_list.picked_items_count}件の商品を削除しますか？" } },
            class: "w-full inline-flex items-center justify-center px-6 py-3 bg-red-600 hover:bg-red-700 active:bg-red-800 text-white font-semibold rounded-lg transition-colors duration-150 min-h-[44px]" do %>
          <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
          </svg>
          カート内商品を削除 (<%= @shopping_list.picked_items_count %>件)
        <% end %>
      </div>
    <% end %>

    <% if @items.empty? %>
      <!-- 空の状態 -->
      <div class="bg-white rounded-xl shadow-sm border border-stone-100 p-8 md:p-12 text-center">
        <div class="max-w-md mx-auto">
          <svg class="w-16 h-16 text-stone-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
          </svg>
          <h2 class="text-xl font-semibold text-stone-800 mb-2">買い物リストが空です</h2>
          <p class="text-base text-stone-600">商品を追加して買い物を始めましょう。</p>
        </div>
      </div>
    <% else %>
      <!-- 商品リスト -->
      <div class="bg-white rounded-xl shadow-sm border border-stone-100 overflow-hidden">
        <div id="shopping_items_list"
             class="divide-y divide-stone-200"
             data-controller="sortable"
             data-sortable-url-value="<%= shopping_list_item_position_path(@shopping_list, ':item_id') %>">
          <% @items.each do |item| %>
            <%= render partial: "shopping_items/item", locals: { item: item } %>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
</div>
